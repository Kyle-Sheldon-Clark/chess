<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Chess</title>
</head>
<body>
    <div id="board">

    </div>
    <script>
        let pieces = [];
        let capturedByBlack = [];
        let capturedByWhite = [];

        let pieceToMove = '';
        let pieceToMoveColor = '';
        let squareText = '';
        let turn = 'white';
        let round = 1;
        let originalSquare;

        function createBoard() {
            let blackSquare = false;
            for (let i = 0; i < 8; i++) {
                let row = document.createElement('div');
                row.classList.add('row');
                for (let j = 0; j < 8; j++) {
                    let square = document.createElement('div');
                    square.classList.add('square');
                    square.setAttribute('id', `${i}-${j}`);
                    square.addEventListener('click', function() {
                        handleClick(square);
                    });
                    let pieceColor;
                    let pieceType;
                    let piecePosition = square.id;
                    if (blackSquare) {
                        square.style.backgroundColor = 'grey';
                        blackSquare = false;
                    } else {
                        blackSquare = true;
                    }

                    if (i === 0 || i === 1) {
                        square.classList.add('blackPiece');
                        pieceColor = 'black';
                    } else if (i === 6 || i === 7) {
                        square.classList.add('whitePiece');
                        pieceColor = 'white';
                    }

                    if ((i === 0 || i === 7) && (j === 0 || j === 7))  {
                        square.classList.add('rook');
                        square.innerText = 'R';
                        pieceType = 'rook';
                    } else if ((i === 0 || i === 7) && (j === 1 || j === 6))  {
                        square.classList.add('knight');
                        square.innerText = 'N';
                        pieceType = 'knight';
                    } else if ((i === 0 || i === 7) && (j === 2 || j === 5))  {
                        square.classList.add('bishop');
                        square.innerText = 'B';
                        pieceType = 'bishop';
                    } else if ((i === 0 || i === 7) && j === 3)  {
                        square.classList.add('queen');
                        square.innerText = 'Q';
                        pieceType = 'queen';
                    } else if ((i === 0 || i === 7) && j === 4)  {
                        square.classList.add('king');
                        square.innerText = 'K';
                        pieceType = 'king';
                    } else if (i === 1 || i === 6) {
                        square.classList.add('pawn');
                        square.innerText = 'p';
                        pieceType = 'pawn';
                    } else {
                        square.classList.add('emptySquare');
                        row.appendChild(square);
                        continue;
                    }
                    row.appendChild(square);
                    buildPiece(pieceType, piecePosition, pieceColor);
                }
                blackSquare = !blackSquare;
                document.getElementById('board').appendChild(row);
            }
        }

        function handleClick(square) {
            
            if (pieceToMove === 'pawn' && validPawnMove(square)) {
                square.classList = `square ${pieceToMove} ${pieceToMoveColor}`;
                square.innerText = squareText;
                pieceToMove = '';
                pieceToMoveColor = '';
                squareText = '';
                if (originalSquare !== square.id) {
                    if (turn === 'white') {
                        turn = 'black';
                    } else {
                        turn = 'white';
                        round++;
                    }
                }
            } else if (pieceToMove === '') {
                if (square.classList.contains('whitePiece') && turn === 'white') {
                    square.classList.add('emptySquare');
                    square.classList.remove('whitePiece');
                    pieceToMoveColor = 'whitePiece';
                } else if (square.classList.contains('blackPiece') && turn === 'black') {
                    square.classList.add('emptySquare');
                    square.classList.remove('blackPiece');
                    pieceToMoveColor = 'blackPiece';
                } else {
                    return;
                }

                if (square.classList.contains('rook')) {
                    square.classList.remove('rook');
                    squareText = square.innerText;
                    square.innerText = '';
                    pieceToMove = 'rook';
                } else if (square.classList.contains('knight')) {
                    square.classList.remove('knight');
                    squareText = square.innerText;
                    square.innerText = '';
                    pieceToMove = 'knight';
                } else if (square.classList.contains('bishop')) {
                    square.classList.remove('bishop');
                    squareText = square.innerText;
                    square.innerText = '';
                    pieceToMove = 'bishop';
                } else if (square.classList.contains('queen')) {
                    square.classList.remove('queen');
                    squareText = square.innerText;
                    square.innerText = '';
                    pieceToMove = 'queen';
                } else if (square.classList.contains('king')) {
                    square.classList.remove('king');
                    squareText = square.innerText;
                    square.innerText = '';
                    pieceToMove = 'king';
                } else if (square.classList.contains('pawn')) {
                    square.classList.remove('pawn');
                    squareText = square.innerText;
                    square.innerText = '';
                    pieceToMove = 'pawn';
                    originalSquare = square.id;
                }
            }
        }

        function buildPiece(type, position, color) {
            pieces.push({
                type: type,
                position: position,
                color: color,
                move: 0,
                alive: true,
            })
        }

        function validPawnMove(squareToCheck) {
            let pawn = pieces.find(obj => {
                return obj.position === originalSquare;
            });

            let originalSquareId = originalSquare.split('-');
            let originalSquareRow = parseInt(originalSquareId[0]);
            let originalSquareColumn = parseInt(originalSquareId[1]);
            
            let squareToCheckId = squareToCheck.id.split('-');
            let squareToCheckRow = parseInt(squareToCheckId[0]);
            let squareToCheckColumn = parseInt(squareToCheckId[1]);

            let squareToCheckValue = document.getElementById(squareToCheck.id).classList;
 
            if (originalSquare === squareToCheck.id) {
                return true;
            }

            if (pawn.move < 1 && turn === 'white') {
                if (originalSquareRow - squareToCheckRow === 2 && originalSquareColumn === squareToCheckColumn && squareToCheckValue.contains('emptySquare')) {
                    pawn.position = squareToCheck.id;
                    pawn.move++;
                    return true;
                } 
            } else if (pawn.move < 1 && turn === 'black') {
                if (squareToCheckRow === originalSquareRow + 2 && originalSquareColumn === squareToCheckColumn && squareToCheckValue.contains('emptySquare')) {
                    pawn.position = squareToCheck.id;
                    pawn.move++;
                    return true;
                }
            }

            if (turn === 'white') {
                if (originalSquareRow - squareToCheckRow === 1 && originalSquareColumn === squareToCheckColumn && squareToCheckValue.contains('emptySquare')) {
                    pawn.position = squareToCheck.id;
                    pawn.move++;
                    return true;
                } else if (Math.abs(originalSquareColumn - squareToCheckColumn) === 1 && squareToCheckValue.contains('blackPiece')) {
                    pawn.position = squareToCheck.id;
                    pawn.move++;
                    capturedByWhite.push('pawn');
                    return true;
                }
            } else if (turn === 'black') {
                if (squareToCheckRow === (originalSquareRow + 1) && originalSquareColumn === squareToCheckColumn && squareToCheckValue.contains('emptySquare')) {
                    pawn.position = squareToCheck.id;
                    pawn.move++;
                    return true;
                } else if (Math.abs(originalSquareColumn - squareToCheckColumn) === 1 && squareToCheckValue.contains('whitePiece')) {
                    pawn.position = squareToCheck.id;
                    pawn.move++;
                    capturedByBlack.push('pawn');
                    return true;
                }
            }
        }
        createBoard();
    </script>
</body>
</html>